<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>labSAFE - Acceso</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="login-container">
        <h1>labSAFE</h1>
        <p class="subtitle">Sistema de Gestion de Temperatura</p>
        
        <!-- Formulario oculto para env√≠o autom√°tico -->
        <form id="loginForm" action="/login" method="POST" style="display: none;">
            <input type="text" id="rfidHidden" name="rfid" value="">
        </form>
        
        <!-- Interfaz visible -->
        <div class="input-group">
            <label for="rfidDisplay">Identificaci√≥n RFID:</label>
            <input type="text" id="rfidDisplay" 
                   placeholder="Acerca tu tarjeta RFID..." 
                   autofocus autocomplete="off">
        </div>
        
        <div id="status-message" class="status">
            <p>Esperando tarjeta...</p>
        </div>
        
        <div id="error-message" class="error" style="display: none;">
            <p>‚ùå Acceso denegado. Tarjeta no v√°lida.</p>
        </div>
    </div>

    <script>
        const rfidDisplay = document.getElementById('rfidDisplay');
        const rfidHidden = document.getElementById('rfidHidden');
        const loginForm = document.getElementById('loginForm');
        const statusMsg = document.getElementById('status-message');
        const errorMsg = document.getElementById('error-message');

        // Limpieza inicial
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.has('error')){
            errorMsg.style.display = 'block';
            statusMsg.style.display = 'none';
            setTimeout(() => {
                errorMsg.style.display = 'none';
                statusMsg.style.display = 'block';
            }, 3000);
        }

        // Funci√≥n para procesar RFID
        function processRFID(uid) {
            if(uid.length < 8) return; // M√≠nimo 8 caracteres
            
            statusMsg.innerHTML = '<p>üîç Procesando...</p>';
            rfidHidden.value = uid;
            loginForm.submit();
        }

        // Evento para lectores RFID que simulan teclado
        rfidDisplay.addEventListener('keypress', function(e) {
            // La mayor√≠a de lectores env√≠an Enter al final
            if(e.key === 'Enter') {
                e.preventDefault();
                processRFID(this.value.trim());
            }
        });

        // Evento para captura en tiempo real (opcional)
        rfidDisplay.addEventListener('input', function() {
            const value = this.value.trim();
            // Si el UID tiene formato XX:XX:XX:XX (11 chars) o similar
            if(value.length >= 11 && (value.match(/:/g) || []).length >= 2) {
                processRFID(value);
            }
        });

        // Enfocar autom√°ticamente
        window.addEventListener('load', () => rfidDisplay.focus());
    </script>
</body>
</html>